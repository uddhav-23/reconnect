<!DOCTYPE html>
<html>
<head>
    <title>Firebase Setup Verification</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 10px 0; background: #0080FF; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0066CC; }
    </style>
</head>
<body>
    <h1>Firebase Setup Verification Tool</h1>
    <p>Open this file in your browser and follow the instructions below.</p>
    
    <h2>Step 1: Add Firebase SDK</h2>
    <p>Add this to the &lt;head&gt; section of this HTML file (or run in browser console on your app):</p>
    <pre>&lt;script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"&gt;&lt;/script&gt;
&lt;script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"&gt;&lt;/script&gt;
&lt;script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"&gt;&lt;/script&gt;</pre>

    <h2>Step 2: Run Diagnostic</h2>
    <p>Open your app, log in, then open browser console (F12) and run:</p>
    <pre id="diagnostic-code">
// Copy and paste this into your browser console (on your app page, not this HTML)
async function checkFirebaseSetup() {
  console.log('=== FIREBASE SETUP DIAGNOSTIC ===\n');
  
  // Check 1: Firebase Auth
  try {
    const auth = firebase.auth();
    const user = auth.currentUser;
    
    if (!user) {
      console.error('❌ NOT LOGGED IN');
      console.log('→ Solution: Log in to your app first');
      return;
    }
    
    console.log('✅ Logged in as:', user.email);
    console.log('   User UID:', user.uid);
    console.log('');
    
    // Check 2: User Document
    const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
    
    if (!userDoc.exists) {
      console.error('❌ USER DOCUMENT MISSING');
      console.log('→ Solution: Create user document in Firestore');
      console.log('→ Collection: users');
      console.log('→ Document ID:', user.uid);
      console.log('→ Required fields: email, name, role="superadmin", universityId');
      return;
    }
    
    console.log('✅ User document exists');
    const userData = userDoc.data();
    console.log('   Document data:', userData);
    console.log('');
    
    // Check 3: Role Field
    if (!userData.role) {
      console.error('❌ ROLE FIELD MISSING');
      console.log('→ Solution: Add "role" field to user document');
      console.log('→ Field type: string');
      console.log('→ Field value: superadmin');
      return;
    }
    
    if (userData.role !== 'superadmin') {
      console.error('❌ ROLE IS NOT SUPERADMIN');
      console.log('   Current role:', userData.role);
      console.log('→ Solution: Update role field to "superadmin"');
      return;
    }
    
    console.log('✅ Role is correct: superadmin');
    console.log('');
    
    // Check 4: Test College Creation
    console.log('Testing college creation permission...');
    try {
      const testRef = firebase.firestore().collection('colleges').doc();
      await testRef.set({
        name: 'TEST_COLLEGE_DELETE_ME',
        description: 'Test',
        universityId: userData.universityId || '1',
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      
      console.log('✅ PERMISSION TEST PASSED!');
      console.log('   College created successfully');
      
      // Clean up
      await testRef.delete();
      console.log('   Test college deleted');
      
    } catch (err) {
      console.error('❌ PERMISSION TEST FAILED');
      console.error('   Error:', err.code, err.message);
      console.log('');
      console.log('→ Check Firestore rules are deployed');
      console.log('→ Make sure rules include isSuperAdmin() function');
      console.log('→ Try logging out and back in');
    }
    
  } catch (error) {
    console.error('❌ ERROR:', error);
  }
  
  console.log('\n=== END DIAGNOSTIC ===');
}

checkFirebaseSetup();
    </pre>
    
    <h2>Step 3: Follow the Console Output</h2>
    <p>The diagnostic will tell you exactly what's wrong and how to fix it.</p>
    
    <h2>Common Issues</h2>
    <ul>
        <li><strong>User document missing:</strong> Create it in Firestore with role="superadmin"</li>
        <li><strong>Role is wrong:</strong> Update role field to exactly "superadmin"</li>
        <li><strong>Rules not deployed:</strong> Copy firestore.rules and publish in Firebase Console</li>
        <li><strong>Not logged in:</strong> Log in to your app first</li>
    </ul>
</body>
</html>

